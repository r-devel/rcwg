[
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] New: Stack Overflow in all.equal with brms family objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n            Bug ID: 18966\n           Summary: Stack Overflow in all.equal with brms family objects\n           Product: R\n           Version: R 4.5.x\n          Hardware: x86_64\/x64\/amd64 (64-bit)\n                OS: Linux-Fedora\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Language\n          Assignee: <mailto:R-core@R-project.org|R-core@R-project.org>\n          Reporter: <mailto:steffen.stell@uni-konstanz.de|steffen.stell@uni-konstanz.de>\n\nCreated attachment 3560\n  --&gt; <https:\/\/bugs.r-project.org\/attachment.cgi?id=3560&amp;action=edit>\nsession_info and traceback\n\nHi,\nusing `base::all.equal()` to compare `brmsfamily` objects to non-identical\nfamily objects, results in a stack overflow on my device. E.g. \n\n```\n&gt; base::all.equal(stats::binomial(), brms::multinomial())\nError: C stack usage  7975436 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7979548 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\n\n```\n\n\nAttached you'll find a `traceback()` and the `session_info()`.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763042062.960529",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "2l4b3",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] New: Stack Overflow in all.equal with brms family objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n            Bug ID: 18966\n           Summary: Stack Overflow in all.equal with brms family objects\n           Product: R\n           Version: R 4.5.x\n          Hardware: x86_64\/x64\/amd64 (64-bit)\n                OS: Linux-Fedora\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Language\n          Assignee: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:R-core@R-project.org",
                                "text": "R-core@R-project.org",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": "\n          Reporter: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:steffen.stell@uni-konstanz.de",
                                "text": "steffen.stell@uni-konstanz.de",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": "\n\nCreated attachment 3560\n  --> "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3560&amp;action=edit",
                                "text": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3560&action=edit"
                            },
                            {
                                "type": "text",
                                "text": "\nsession_info and traceback\n\nHi,\nusing "
                            },
                            {
                                "type": "text",
                                "text": "base::all.equal()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to compare "
                            },
                            {
                                "type": "text",
                                "text": "brmsfamily",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " objects to non-identical\nfamily objects, results in a stack overflow on my device. E.g. \n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "> base::all.equal(stats::binomial(), brms::multinomial())\nError: C stack usage  7975436 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7979036 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\nError: C stack usage  7979548 is too close to the limit\nError: C stack usage  7978780 is too close to the limit\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\n\n\nAttached you'll find a "
                            },
                            {
                                "type": "text",
                                "text": "traceback()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and the "
                            },
                            {
                                "type": "text",
                                "text": "session_info()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\nMikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n                 CC|                            |jaganmn@mcmaster.ca\n\n--- Comment #1 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\nIt is reproducible without loading any contributed packages, so, yes, there\nseems to be a bug in R, maybe some missing logic in `all.equal.*`.  I can take\na look later today ...\n\n```\nx &lt;- stats::binomial()\ny &lt;- structure(list(family = \"multinomial\",\n                    link = \"logit\",\n                    linkfun = function (mu) link(mu, link = slink),\n                    linkinv = function (eta) inv_link(eta, link = slink),\n                    dpars = NULL,\n                    multi_dpars = \"mu\",\n                    type = \"int\",\n                    ybounds = c(-Inf, Inf),\n                    closed = c(NA, NA),\n                    ad = c(\"weights\", \"subset\", \"trials\", \"index\"),\n                    specials = c(\"multinomial\", \"joint_link\"),\n                    include = \"fun_multinomial_logit.stan\",\n                    normalized = \"\"),\n               class = c(\"brmsfamily\", \"family\"))\nall.equal(x, y) # Error: C stack usage  7954064 is too close to the limit\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763061118.591369",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "HZAnP",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\nMikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n                 CC|                            |jaganmn@mcmaster.ca\n\n--- Comment #1 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nIt is reproducible without loading any contributed packages, so, yes, there\nseems to be a bug in R, maybe some missing logic in "
                            },
                            {
                                "type": "text",
                                "text": "all.equal.*",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".  I can take\na look later today ...\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "x <- stats::binomial()\ny <- structure(list(family = \"multinomial\",\n                    link = \"logit\",\n                    linkfun = function (mu) link(mu, link = slink),\n                    linkinv = function (eta) inv_link(eta, link = slink),\n                    dpars = NULL,\n                    multi_dpars = \"mu\",\n                    type = \"int\",\n                    ybounds = c(-Inf, Inf),\n                    closed = c(NA, NA),\n                    ad = c(\"weights\", \"subset\", \"trials\", \"index\"),\n                    specials = c(\"multinomial\", \"joint_link\"),\n                    include = \"fun_multinomial_logit.stan\",\n                    normalized = \"\"),\n               class = c(\"brmsfamily\", \"family\"))\nall.equal(x, y) # Error: C stack usage  7954064 is too close to the limit\n"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\nLuke Tierney (<mailto:luke@stat.uiowa.edu|luke@stat.uiowa.edu>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|UNCONFIRMED                 |CONFIRMED\n     Ever confirmed|0                           |1\n                 CC|                            |luke@stat.uiowa.edu\n\n--- Comment #2 from Luke Tierney (<mailto:luke@stat.uiowa.edu|luke@stat.uiowa.edu>) ---\nThis simpler example hits the C stack limit for me:\n\n```\nx &lt;- stats::binomial()$validmu\nall.equal(x, NULL)\n```\n\nThe problem has something to do with the cycle in the environments, but I'm not\nyet sure exactly where this is biting.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763068933.519709",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "U6FKt",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\nLuke Tierney ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:luke@stat.uiowa.edu",
                                "text": "luke@stat.uiowa.edu",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|UNCONFIRMED                 |CONFIRMED\n     Ever confirmed|0                           |1\n                 CC|                            |luke@stat.uiowa.edu\n\n--- Comment #2 from Luke Tierney ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:luke@stat.uiowa.edu",
                                "text": "luke@stat.uiowa.edu",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") ---\nThis simpler example hits the C stack limit for me:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "x <- stats::binomial()$validmu\nall.equal(x, NULL)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nThe problem has something to do with the cycle in the environments, but I'm not\nyet sure exactly where this is biting."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n--- Comment #3 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\n(In reply to Luke Tierney from comment #2)\nOn top of addressing the cycle entered by `all.equal.environment`, it seems\nthat we will want:\n\n```\nIndex: src\/library\/base\/R\/all.equal.R\n===================================================================\n--- src\/library\/base\/R\/all.equal.R      (revision 89009)\n+++ src\/library\/base\/R\/all.equal.R      (working copy)\n@@ -80,7 +80,7 @@\n all.equal.function &lt;- function(target, current, check.environment = TRUE, ...)\n {\n     msg &lt;- all.equal.language(target, current, ...)\n-    if(check.environment) {\n+    if(is.function(current) &amp;&amp; check.environment) {\n         ## pre-check w\/ identical(), for speed &amp; against infinite recursion:\n         ee &lt;- identical(environment(target),\n                         environment(current), ignore.environment=FALSE)\n```\n\nIt does not make sense for `all.equal.function` to compare\n`environment(target)` and `environment(current)` if `current` is not a\nfunction, even if `current` is an object admitting an environment, like a\nformula.  In particular, it does not make sense to, as here, compare\n`environment(target)` and `environment(NULL)`, as the latter is the evaluation\nframe ...",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763077311.639139",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "tMvLy",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #3 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\n(In reply to Luke Tierney from comment #2)\nOn top of addressing the cycle entered by "
                            },
                            {
                                "type": "text",
                                "text": "all.equal.environment",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", it seems\nthat we will want:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Index: src\/library\/base\/R\/all.equal.R\n===================================================================\n--- src\/library\/base\/R\/all.equal.R      (revision 89009)\n+++ src\/library\/base\/R\/all.equal.R      (working copy)\n@@ -80,7 +80,7 @@\n all.equal.function <- function(target, current, check.environment = TRUE, ...)\n {\n     msg <- all.equal.language(target, current, ...)\n-    if(check.environment) {\n+    if(is.function(current) && check.environment) {\n         ## pre-check w\/ identical(), for speed & against infinite recursion:\n         ee <- identical(environment(target),\n                         environment(current), ignore.environment=FALSE)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nIt does not make sense for "
                            },
                            {
                                "type": "text",
                                "text": "all.equal.function",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to compare\n"
                            },
                            {
                                "type": "text",
                                "text": "environment(target)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and "
                            },
                            {
                                "type": "text",
                                "text": "environment(current)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " if "
                            },
                            {
                                "type": "text",
                                "text": "current",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " is not a\nfunction, even if "
                            },
                            {
                                "type": "text",
                                "text": "current",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " is an object admitting an environment, like a\nformula.  In particular, it does not make sense to, as here, compare\n"
                            },
                            {
                                "type": "text",
                                "text": "environment(target)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and "
                            },
                            {
                                "type": "text",
                                "text": "environment(NULL)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", as the latter is the evaluation\nframe ..."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n--- Comment #4 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\nFurther analysis suggests that the patch in comment 2 might suffice.\n\nThe sorted names of the evaluation frame of the `all.equal.function` call (that\nis, `environment(current)` when `current` is `NULL`) are:\n\n```\n [1] \"...\"               \".Class\"            \".Generic\"         \n [4] \".GenericCallEnv\"   \".GenericDefEnv\"    \".Group\"           \n [7] \".Method\"           \"check.environment\" \"current\"          \n[10] \"ee\"                \"msg\"               \"target\"           \n```\n\nThe name `\"current\"`, corresponding to value `NULL`, has index 9.  If we take\nthe sorted names of `environment(target)` and find at index 9 the name of a\nfunction whose environment is also `environment(target)`, then we enter a\ncycle, because that function is compared with `current`, whose value is still\n`NULL`.\n\nSo it is just \"bad luck\" that the base namespace (as of r89017) has\n`\"$&lt;-.POSIXlt\"` as its 9th name, after sorting.\n\nHere is an example and a counterexample not relying on the content of the base\nnamespace:\n\n```\ne &lt;- new.env(parent = emptyenv())\nfor (s in letters) e[[s]] &lt;- s\ne$i &lt;- function () NULL # letters[9L] == \"i\"\nenvironment(e$i) &lt;- e\nall.equal(e$i, NULL) # Error: C stack usage  7953984 is too close to the limit\ne$j &lt;- e$i # letters[9L] != \"j\"\ne$i &lt;- \"i\"\nall.equal(e$j, NULL) # OK\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763079693.381479",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "7oqP0",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #4 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nFurther analysis suggests that the patch in comment 2 might suffice.\n\nThe sorted names of the evaluation frame of the "
                            },
                            {
                                "type": "text",
                                "text": "all.equal.function",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " call (that\nis, "
                            },
                            {
                                "type": "text",
                                "text": "environment(current)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " when "
                            },
                            {
                                "type": "text",
                                "text": "current",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " is "
                            },
                            {
                                "type": "text",
                                "text": "NULL",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ") are:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": " [1] \"...\"               \".Class\"            \".Generic\"         \n [4] \".GenericCallEnv\"   \".GenericDefEnv\"    \".Group\"           \n [7] \".Method\"           \"check.environment\" \"current\"          \n[10] \"ee\"                \"msg\"               \"target\"           \n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nThe name "
                            },
                            {
                                "type": "text",
                                "text": "\"current\"",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", corresponding to value "
                            },
                            {
                                "type": "text",
                                "text": "NULL",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", has index 9.  If we take\nthe sorted names of "
                            },
                            {
                                "type": "text",
                                "text": "environment(target)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and find at index 9 the name of a\nfunction whose environment is also "
                            },
                            {
                                "type": "text",
                                "text": "environment(target)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", then we enter a\ncycle, because that function is compared with "
                            },
                            {
                                "type": "text",
                                "text": "current",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", whose value is still\n"
                            },
                            {
                                "type": "text",
                                "text": "NULL",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".\n\nSo it is just \"bad luck\" that the base namespace (as of r89017) has\n"
                            },
                            {
                                "type": "text",
                                "text": "\"$<-.POSIXlt\"",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " as its 9th name, after sorting.\n\nHere is an example and a counterexample not relying on the content of the base\nnamespace:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "e <- new.env(parent = emptyenv())\nfor (s in letters) e[[s]] <- s\ne$i <- function () NULL # letters[9L] == \"i\"\nenvironment(e$i) <- e\nall.equal(e$i, NULL) # Error: C stack usage  7953984 is too close to the limit\ne$j <- e$i # letters[9L] != \"j\"\ne$i <- \"i\"\nall.equal(e$j, NULL) # OK\n"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n--- Comment #5 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\n(In reply to Mikael Jagan from comment #4)\n&gt; Here is an example and a counterexample not relying on the content of the\n&gt; base namespace:\n\nClearly, they do rely on the critical index being 9, but that can change as the\ndefinition of `all.equal.function` changes over time.  An actual regression\ntest should allow for some fuzz.  E.g., the following would trigger the cycle\nfor indices 1 through 26:\n\n```\ne &lt;- new.env(parent = emptyenv())\nf &lt;- function () NULL\nenvironment(f) &lt;- e\nfor (s in letters) e[[s]] &lt;- f\nall.equal(f, NULL)\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763080646.283509",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "dQL",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #5 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\n(In reply to Mikael Jagan from comment #4)"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_quote",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Here is an example and a counterexample not relying on the content of the\nbase namespace:"
                            }
                        ],
                        "contains_padding": true
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nClearly, they do rely on the critical index being 9, but that can change as the\ndefinition of "
                            },
                            {
                                "type": "text",
                                "text": "all.equal.function",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " changes over time.  An actual regression\ntest should allow for some fuzz.  E.g., the following would trigger the cycle\nfor indices 1 through 26:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "e <- new.env(parent = emptyenv())\nf <- function () NULL\nenvironment(f) <- e\nfor (s in letters) e[[s]] <- f\nall.equal(f, NULL)\n"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n--- Comment #6 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\n(In reply to Mikael Jagan from comment #4)\n&gt; Here is an example and a counterexample not relying on the content of the\n&gt; base namespace:\n\nSorry, another clarification ...\n\nI mentioned the base namespace because the example that I was using locally was\n`all.equal(identity, NULL)`.  It is easy to see that we have the very same\nsituation with `all.equal(stats::binomial()$validmu, NULL)`:\n\n```\ne &lt;- environment(stats::binomial()$validmu)\ns &lt;- names(as.list(e, sorted = TRUE))[9L] # \"validmu\"\nidentical(environment(e[[s]]), e) # TRUE\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763082090.959159",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "Z9iU",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #6 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\n(In reply to Mikael Jagan from comment #4)"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_quote",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Here is an example and a counterexample not relying on the content of the\nbase namespace:"
                            }
                        ],
                        "contains_padding": true
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nSorry, another clarification ...\n\nI mentioned the base namespace because the example that I was using locally was\n"
                            },
                            {
                                "type": "text",
                                "text": "all.equal(identity, NULL)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".  It is easy to see that we have the very same\nsituation with "
                            },
                            {
                                "type": "text",
                                "text": "all.equal(stats::binomial()$validmu, NULL)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ":\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "e <- environment(stats::binomial()$validmu)\ns <- names(as.list(e, sorted = TRUE))[9L] # \"validmu\"\nidentical(environment(e[[s]]), e) # TRUE\n"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\n--- Comment #7 from Luke Tierney (<mailto:luke@stat.uiowa.edu|luke@stat.uiowa.edu>) ---\nThanks for the original report Steffen and thanks Mikael for all the analysis.\n\nOne more simple way to trigger this:\n\n```\nall.equal(identity, NULL)\n```\n\nI committed in r89018 a change to skip the environment check if\n`is.null(current)`. I'll leave it to Martin Maechler as the primary maintainer\nof `all.equal` to decide if he wants to go further.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763087352.053429",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "aTem",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #7 from Luke Tierney ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:luke@stat.uiowa.edu",
                                "text": "luke@stat.uiowa.edu",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") ---\nThanks for the original report Steffen and thanks Mikael for all the analysis.\n\nOne more simple way to trigger this:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "all.equal(identity, NULL)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nI committed in r89018 a change to skip the environment check if\n"
                            },
                            {
                                "type": "text",
                                "text": "is.null(current)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ". I'll leave it to Martin Maechler as the primary maintainer\nof "
                            },
                            {
                                "type": "text",
                                "text": "all.equal",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to decide if he wants to go further."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966>\n\nLuke Tierney (<mailto:luke@stat.uiowa.edu|luke@stat.uiowa.edu>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|CONFIRMED                   |CLOSED\n         Resolution|---                         |FIXED",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763087373.046579",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RIg\/7",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18966] Stack Overflow in all.equal() with brmsfamily objects",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18966"
                            },
                            {
                                "type": "text",
                                "text": "\n\nLuke Tierney ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:luke@stat.uiowa.edu",
                                "text": "luke@stat.uiowa.edu",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|CONFIRMED                   |CLOSED\n         Resolution|---                         |FIXED"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18967] New: Mismatched standard package &amp; R version requirements should be an error*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18967>\n\n            Bug ID: 18967\n           Summary: Mismatched standard package &amp; R version requirements\n                    should be an error\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: All\n                OS: All\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Installation\n          Assignee: <mailto:R-core@R-project.org|R-core@R-project.org>\n          Reporter: <mailto:michaelchirico4@gmail.com|michaelchirico4@gmail.com>\n\nI just tried installing a package (coneproj) with this in DESCRIPTION\n\n```\nDepends: R(&gt;= 4.4.0)\nImports: Rcpp (&gt;= 0.10.4), methods (&gt;= 4.5.0)\n```\n\nWhen run from R 4.4.0, installation fail like so:\n\n```\ninstall.packages(\"coneproj\")\n# Warning: dependency methods is not available\n# &lt;does full compilation of src\/ code&gt;\n# more output\n# ** byte-compile and prepare package for lazy loading\n# Error in loadNamespace(j &lt;- i[[1L]], c(lib.loc, .libPaths()), versionCheck =\nvI[[j]]) : \n#   namespace methods 4.4.0 is already loaded, but &gt;= 4.5.0 is required\n# Calls: &lt;Anonymous&gt; ... namespaceImportFrom -&gt; asNamespace -&gt; loadNamespace\n# Execution halted\n# ERROR: lazy loading failed for package coneproj\n# * removing\n\/media\/michael\/69913553-793b-4435-ac82-0e7df8e34b9f\/tmpCRAN\/coneproj\n```\n\nThis seems like a waste of time. I can't think of a reason to put a version\nrequirement on a standard package in `Depends`, `Imports`, or `LinkingTo`. Even\ndoing so once when they all agree risks them drifting apart over time.\nConceivably there could be a use for doing so on weaker dependencies like\n`Suggests`.\n\nI think it's preferable to require standardization to version requirements on\n`R` alone, but certainly any requirements among hard dependencies on standard\npackages must agree.\n\nI find 246 packages on CRAN with such mismatching version requirements on\nstandard packages, including Arothron which has 5 distinct version\nrequirements:\n\n<https:\/\/cran.r-project.org\/web\/packages\/Arothron\/index.html>\n\n```\ndb = data.frame(available.packages())\n\ndefault_packages &lt;- tools:::.get_standard_package_names()$base\n\nfor (dep in c(\"Depends\", \"Imports\", \"LinkingTo\"))\n  db[[dep]] = lapply(db[[dep]], \\(x) if (!<http:\/\/is.na|is.na>(x))\ntools:::.split_dependencies(x))\ndb$hard_deps &lt;- lapply(\n  seq_len(nrow(db)),\n  \\(i) c(db$Depends[[i]], db$Imports[[i]], db$LinkingTo[[i]])\n)\ndb$default_deps &lt;- lapply(\n  db$hard_deps,\n  \\(x) x[names(x) %in% c(\"R\", default_packages)]\n)\ndb$default_deps_versions &lt;- lapply(\n  db$default_deps,\n  \\(x) Filter(length, lapply(x, \\(xi) xi$version))\n)\ndb$n_distinct_default_deps_versions &lt;- vapply(\n  db$default_deps_versions,\n  \\(x) length(unique(unlist(x, recursive=FALSE))),\n  integer(1L)\n)\ntable(db$n_distinct_default_deps_versions)\n#     0     1     2     3     5 \n#  7125 15631   228    17     1 \n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1763097916.674379",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "8I8S",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18967] New: Mismatched standard package & R version requirements should be an error",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18967"
                            },
                            {
                                "type": "text",
                                "text": "\n\n            Bug ID: 18967\n           Summary: Mismatched standard package & R version requirements\n                    should be an error\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: All\n                OS: All\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Installation\n          Assignee: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:R-core@R-project.org",
                                "text": "R-core@R-project.org",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": "\n          Reporter: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:michaelchirico4@gmail.com",
                                "text": "michaelchirico4@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": "\n\nI just tried installing a package (coneproj) with this in DESCRIPTION\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Depends: R(>= 4.4.0)\nImports: Rcpp (>= 0.10.4), methods (>= 4.5.0)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nWhen run from R 4.4.0, installation fail like so:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "install.packages(\"coneproj\")\n# Warning: dependency 'methods' is not available\n# <does full compilation of src\/ code>\n# more output\n# ** byte-compile and prepare package for lazy loading\n# Error in loadNamespace(j <- i[[1L]], c(lib.loc, .libPaths()), versionCheck =\nvI[[j]]) : \n#   namespace 'methods' 4.4.0 is already loaded, but >= 4.5.0 is required\n# Calls: <Anonymous> ... namespaceImportFrom -> asNamespace -> loadNamespace\n# Execution halted\n# ERROR: lazy loading failed for package 'coneproj'\n# * removing\n'\/media\/michael\/69913553-793b-4435-ac82-0e7df8e34b9f\/tmpCRAN\/coneproj'\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nThis seems like a waste of time. I can't think of a reason to put a version\nrequirement on a standard package in "
                            },
                            {
                                "type": "text",
                                "text": "Depends",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", "
                            },
                            {
                                "type": "text",
                                "text": "Imports",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", or "
                            },
                            {
                                "type": "text",
                                "text": "LinkingTo",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ". Even\ndoing so once when they all agree risks them drifting apart over time.\nConceivably there could be a use for doing so on weaker dependencies like\n"
                            },
                            {
                                "type": "text",
                                "text": "Suggests",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".\n\nI think it's preferable to require standardization to version requirements on\n"
                            },
                            {
                                "type": "text",
                                "text": "R",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " alone, but certainly any requirements among hard dependencies on standard\npackages must agree.\n\nI find 246 packages on CRAN with such mismatching version requirements on\nstandard packages, including Arothron which has 5 distinct version\nrequirements:\n\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/cran.r-project.org\/web\/packages\/Arothron\/index.html"
                            },
                            {
                                "type": "text",
                                "text": "\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "db = data.frame(available.packages())\n\ndefault_packages <- tools:::.get_standard_package_names()$base\n\nfor (dep in c(\"Depends\", \"Imports\", \"LinkingTo\"))\n  db[[dep]] = lapply(db[[dep]], \\(x) if (!"
                            },
                            {
                                "type": "link",
                                "url": "http:\/\/is.na",
                                "text": "is.na"
                            },
                            {
                                "type": "text",
                                "text": "(x))\ntools:::.split_dependencies(x))\ndb$hard_deps <- lapply(\n  seq_len(nrow(db)),\n  \\(i) c(db$Depends[[i]], db$Imports[[i]], db$LinkingTo[[i]])\n)\ndb$default_deps <- lapply(\n  db$hard_deps,\n  \\(x) x[names(x) %in% c(\"R\", default_packages)]\n)\ndb$default_deps_versions <- lapply(\n  db$default_deps,\n  \\(x) Filter(length, lapply(x, \\(xi) xi$version))\n)\ndb$n_distinct_default_deps_versions <- vapply(\n  db$default_deps_versions,\n  \\(x) length(unique(unlist(x, recursive=FALSE))),\n  integer(1L)\n)\ntable(db$n_distinct_default_deps_versions)\n#     0     1     2     3     5 \n#  7125 15631   228    17     1 \n"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]