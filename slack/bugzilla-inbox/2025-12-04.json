[
    {
        "subtype": "bot_message",
        "text": "*[Bug 18974] tools::Rdiff(nullPointers=TRUE) does not convert glibc's (nil)*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18974>\n\nMikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n   Attachment #3571|0                           |1\n        is obsolete|                            |\n\n--- Comment #2 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\nCreated attachment 3576\n  --&gt; <https:\/\/bugs.r-project.org\/attachment.cgi?id=3576&amp;action=edit>\ntools::Rdiff(nullPointers=TRUE) converting glibc's (nil) (amended)\n\nAmending attachment 3571 which by mistake put the regression test under\n`tests\/` instead of under `src\/library\/tools\/tests\/`.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764879973.083159",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "BD5",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18974] tools::Rdiff(nullPointers=TRUE) does not convert glibc's (nil)",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18974"
                            },
                            {
                                "type": "text",
                                "text": "\n\nMikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n   Attachment #3571|0                           |1\n        is obsolete|                            |\n\n--- Comment #2 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nCreated attachment 3576\n  --> "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3576&amp;action=edit",
                                "text": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3576&action=edit"
                            },
                            {
                                "type": "text",
                                "text": "\ntools::Rdiff(nullPointers=TRUE) converting glibc's (nil) (amended)\n\nAmending attachment 3571 which by mistake put the regression test under\n"
                            },
                            {
                                "type": "text",
                                "text": "tests\/",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " instead of under "
                            },
                            {
                                "type": "text",
                                "text": "src\/library\/tools\/tests\/",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18972] diff(x=&lt;m-by-n&gt;, l, d) drops dimensions when l*d &gt;= m*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18972>\n\n--- Comment #8 from Martin Maechler (<mailto:maechler@stat.math.ethz.ch|maechler@stat.math.ethz.ch>) ---\nI have switched R-devel to using patch 3572, thank you Suharto; \nit is nice to simplify the code such that it still achieves the goal.\n-&gt; svn rev 89098\n\nAdditionally, I have also added a new `if(is.null(e12)) { ... }` clause to\n`diff.ts()` such that `m &lt;- ts(matrix()); diff(m)` now returns a (zero-extent)\nmatrix, the same as `m - lag(m, -1)`:   svn r 89093 + 89094",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764883872.554649",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "sPE",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "*[Bug 18972] diff(x=<m-by-n>, l, d) drops dimensions when l*d >= m*\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18972"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #8 from Martin Maechler ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:maechler@stat.math.ethz.ch",
                                "text": "maechler@stat.math.ethz.ch",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") ---\nI have switched R-devel to using patch 3572, thank you Suharto; \nit is nice to simplify the code such that it still achieves the goal.\n-> svn rev 89098\n\nAdditionally, I have also added a new "
                            },
                            {
                                "type": "text",
                                "text": "if(is.null(e12)) { ... }",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " clause to\n"
                            },
                            {
                                "type": "text",
                                "text": "diff.ts()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " such that "
                            },
                            {
                                "type": "text",
                                "text": "m <- ts(matrix()); diff(m)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " now returns a (zero-extent)\nmatrix, the same as "
                            },
                            {
                                "type": "text",
                                "text": "m - lag(m, -1)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ":   svn r 89093 + 89094"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18977] New: model.frame(~1, list()) constructs an invalid data frame*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977>\n\n            Bug ID: 18977\n           Summary: model.frame(~1, list()) constructs an invalid data\n                    frame\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: Other\n                OS: Other\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Low-level\n          Assignee: <mailto:R-core@R-project.org|R-core@R-project.org>\n          Reporter: <mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>\n\nIt is more or less documented that the `row.names` attribute of a data frame\nwith `n` rows must be a character vector of length `n`, an integer vector of\nlength `n`, or an altrep-like integer vector representing `seq_len(n)`\ncompactly.  See, e.g., `help(\"row.names\")` and `help(\".row_names_info\")`.\n\nI notice today that it is possible to construct a \"data frame\" whose\n`row.names` attribute is `NULL`:\n\n```\n&gt; (x &lt;- model.frame(~1, list(), na.action = na.pass))\ndata frame with 0 columns and 0 rows\n&gt; .row_names_info(x, 0L)\nNULL\n```\n\nHere, I expect not `NULL` but the value of `.set_row_names(0L)`, namely\n`integer(0L)`.  A consequence is\n\n```\n&gt; attr(x, \"row.names\")\nNULL\n```\n\ncontradicting `help(\"row.names\")`, which says:\n\n&gt; Row names are currently allowed to be integer or character, ....  (Use `attr(x, \"row.names\")` if you need to retrieve an integer-valued set of row names.)\n\nThat this object is invalid seems to go unnoticed by many methods for\n`data.frame`, but it does trip up `complete.cases`:\n\n```\n&gt; complete.cases(x)\nError in complete.cases(x) : no input has determined the number of cases\n```\n\nwhereas\n\n```\n&gt; complete.cases(data.frame())\nlogical(0)\n```\n\nIndeed, the C function `compcases` more or less tests\n`is.null(.row_names_info(x, 0L))` and decides on that basis whether the list\n`x` is a data frame.\n\nThe following patch for the C function `modelframe` fixes things and passes\n`make check-all`.\n\n```\nIndex: src\/library\/stats\/src\/model.c\n===================================================================\n--- src\/library\/stats\/src\/model.c       (revision 89085)\n+++ src\/library\/stats\/src\/model.c       (working copy)\n@@ -169,15 +169,17 @@\n     PROTECT(tmp = mkString(\"data.frame\"));\n     setAttrib(data, R_ClassSymbol, tmp);\n     UNPROTECT(1);\n-    if (length(row_names) == nr) {\n+    if (length(row_names) == nr &amp;&amp; nr &gt; 0) {\n        setAttrib(data, R_RowNamesSymbol, row_names);\n     } else {\n        \/*\n        PROTECT(row_names = allocVector(INTSXP, nr));\n        for (i = 0; i &lt; nr; i++) INTEGER(row_names)[i] = i+1; *\/\n-       PROTECT(row_names = allocVector(INTSXP, 2));\n+       PROTECT(row_names = allocVector(INTSXP, (nr &gt; 0) ? 2 : 0));\n+       if (nr &gt; 0) {\n        INTEGER(row_names)[0] = NA_INTEGER;\n        INTEGER(row_names)[1] = nr;\n+       }\n        setAttrib(data, R_RowNamesSymbol, row_names);\n        UNPROTECT(1);\n     }\n```\n\nI don't where under `src\/library\/stats\/tests` to put the regression test, so I\nwill just share the code:\n\n```\n## model.frame(~1, list()) constructed invalid data frame with\n## 'row.names' attribute NULL rather than empty integer|character\nchk &lt;- function(x, rn) stopifnot(exprs = {\n    is.data.frame(x)\n    identical(.row_names_info(x, 0L), rn)\n    identical(.row_names_info(x, 1L), 0L)\n    identical(.row_names_info(x, 2L), 0L)\n    identical(attr(x, \"row.names\"),\n              if (is.character(rn)) character(0L) else integer(0L))\n    identical(row.names(x), character(0L))\n})\na0 &lt;- .set_row_names(0L) # [a]utomatic\ni0 &lt;- integer(0L)\nc0 &lt;- character(0L)\nstopifnot(identical(a0, i0)) # currently, but not documented\nchk(da &lt;- data.frame(row.names =   ), a0)\nchk(di &lt;- data.frame(row.names = i0), i0)\nchk(dc &lt;- data.frame(row.names = c0), c0)\nona &lt;- options(na.action = \"na.pass\") # =&gt; testing 'model.frame' proper\nchk(mfa &lt;- model.frame(~1, da), a0)\n",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764886115.002279",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "AWA",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18977] New: model.frame(~1, list()) constructs an invalid data frame",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977"
                            },
                            {
                                "type": "text",
                                "text": "\n\n            Bug ID: 18977\n           Summary: model.frame(~1, list()) constructs an invalid data\n                    frame\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: Other\n                OS: Other\n            Status: UNCONFIRMED\n          Severity: normal\n          Priority: P5\n         Component: Low-level\n          Assignee: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:R-core@R-project.org",
                                "text": "R-core@R-project.org",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": "\n          Reporter: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": "\n\nIt is more or less documented that the "
                            },
                            {
                                "type": "text",
                                "text": "row.names",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " attribute of a data frame\nwith "
                            },
                            {
                                "type": "text",
                                "text": "n",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " rows must be a character vector of length "
                            },
                            {
                                "type": "text",
                                "text": "n",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", an integer vector of\nlength "
                            },
                            {
                                "type": "text",
                                "text": "n",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", or an altrep-like integer vector representing "
                            },
                            {
                                "type": "text",
                                "text": "seq_len(n)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\ncompactly.  See, e.g., "
                            },
                            {
                                "type": "text",
                                "text": "help(\"row.names\")",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and "
                            },
                            {
                                "type": "text",
                                "text": "help(\".row_names_info\")",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".\n\nI notice today that it is possible to construct a \"data frame\" whose\n"
                            },
                            {
                                "type": "text",
                                "text": "row.names",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " attribute is "
                            },
                            {
                                "type": "text",
                                "text": "NULL",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ":\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "> (x <- model.frame(~1, list(), na.action = na.pass))\ndata frame with 0 columns and 0 rows\n> .row_names_info(x, 0L)\nNULL\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nHere, I expect not "
                            },
                            {
                                "type": "text",
                                "text": "NULL",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " but the value of "
                            },
                            {
                                "type": "text",
                                "text": ".set_row_names(0L)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", namely\n"
                            },
                            {
                                "type": "text",
                                "text": "integer(0L)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".  A consequence is\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "> attr(x, \"row.names\")\nNULL\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\ncontradicting "
                            },
                            {
                                "type": "text",
                                "text": "help(\"row.names\")",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", which says:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_quote",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Row names are currently allowed to be integer or character, ....  (Use "
                            },
                            {
                                "type": "text",
                                "text": "attr(x, \"row.names\")",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " if you need to retrieve an integer-valued set of row names.)"
                            }
                        ],
                        "contains_padding": true
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nThat this object is invalid seems to go unnoticed by many methods for\n"
                            },
                            {
                                "type": "text",
                                "text": "data.frame",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", but it does trip up "
                            },
                            {
                                "type": "text",
                                "text": "complete.cases",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ":\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "> complete.cases(x)\nError in complete.cases(x) : no input has determined the number of cases\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nwhereas\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "> complete.cases(data.frame())\nlogical(0)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nIndeed, the C function "
                            },
                            {
                                "type": "text",
                                "text": "compcases",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " more or less tests\n"
                            },
                            {
                                "type": "text",
                                "text": "is.null(.row_names_info(x, 0L))",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and decides on that basis whether the list\n"
                            },
                            {
                                "type": "text",
                                "text": "x",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " is a data frame.\n\nThe following patch for the C function "
                            },
                            {
                                "type": "text",
                                "text": "modelframe",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " fixes things and passes\n"
                            },
                            {
                                "type": "text",
                                "text": "make check-all",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Index: src\/library\/stats\/src\/model.c\n===================================================================\n--- src\/library\/stats\/src\/model.c       (revision 89085)\n+++ src\/library\/stats\/src\/model.c       (working copy)\n@@ -169,15 +169,17 @@\n     PROTECT(tmp = mkString(\"data.frame\"));\n     setAttrib(data, R_ClassSymbol, tmp);\n     UNPROTECT(1);\n-    if (length(row_names) == nr) {\n+    if (length(row_names) == nr && nr > 0) {\n        setAttrib(data, R_RowNamesSymbol, row_names);\n     } else {\n        \/*\n        PROTECT(row_names = allocVector(INTSXP, nr));\n        for (i = 0; i < nr; i++) INTEGER(row_names)[i] = i+1; *\/\n-       PROTECT(row_names = allocVector(INTSXP, 2));\n+       PROTECT(row_names = allocVector(INTSXP, (nr > 0) ? 2 : 0));\n+       if (nr > 0) {\n        INTEGER(row_names)[0] = NA_INTEGER;\n        INTEGER(row_names)[1] = nr;\n+       }\n        setAttrib(data, R_RowNamesSymbol, row_names);\n        UNPROTECT(1);\n     }\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nI don't where under "
                            },
                            {
                                "type": "text",
                                "text": "src\/library\/stats\/tests",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to put the regression test, so I\nwill just share the code:\n\n```\n## model.frame(~1, list()) constructed invalid data frame with\n## 'row.names' attribute NULL rather than empty integer|character\nchk <- function(x, rn) stopifnot(exprs = {\n    is.data.frame(x)\n    identical(.row_names_info(x, 0L), rn)\n    identical(.row_names_info(x, 1L), 0L)\n    identical(.row_names_info(x, 2L), 0L)\n    identical(attr(x, \"row.names\"),\n              if (is.character(rn)) character(0L) else integer(0L))\n    identical(row.names(x), character(0L))\n})\na0 <- .set_row_names(0L) # [a]utomatic\ni0 <- integer(0L)\nc0 <- character(0L)\nstopifnot(identical(a0, i0)) # currently, but not documented\nchk(da <- data.frame(row.names =   ), a0)\nchk(di <- data.frame(row.names = i0), i0)\nchk(dc <- data.frame(row.names = c0), c0)\nona <- options(na.action = \"na.pass\") # => testing 'model.frame' proper\nchk(mfa <- model.frame(~1, da), a0)"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "chk(mfi &lt;- model.frame(~1, di), i0)\nchk(mfc &lt;- model.frame(~1, dc), c0)\nchk(mfl &lt;- model.frame(~1, list()), a0) # failed\n## Error .... : identical(.row_names_info(x, 0L), rn) is not TRUE\n.row_names_info(mfl, 0L) # was NULL, not a0\noptions(ona)\nL &lt;- list(da, di, dc, mfa, mfi, mfc, mfl)\nstopifnot(identical(lapply(L, complete.cases),\n                    rep(list(logical(0L)), length(L)))) # failed for mfl\n## Error .... : no input has determined the number of cases\n## stats:::na.fail.default calls 'complete.cases', hence:\nmodel.frame(~1, list(), na.action = na.fail) # failed similarly\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764886115.030159",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "RWCIs",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "chk(mfi <- model.frame(~1, di), i0)\nchk(mfc <- model.frame(~1, dc), c0)\nchk(mfl <- model.frame(~1, list()), a0) # failed\n## Error .... : identical(.row_names_info(x, 0L), rn) is not TRUE\n.row_names_info(mfl, 0L) # was NULL, not a0\noptions(ona)\nL <- list(da, di, dc, mfa, mfi, mfc, mfl)\nstopifnot(identical(lapply(L, complete.cases),\n                    rep(list(logical(0L)), length(L)))) # failed for mfl\n## Error .... : no input has determined the number of cases\n## stats:::na.fail.default calls 'complete.cases', hence:\nmodel.frame(~1, list(), na.action = na.fail) # failed similarly\n```"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]