[
    {
        "subtype": "bot_message",
        "text": "*[Bug 18972] diff(x=&lt;m-by-n&gt;, l, d) drops dimensions when l*d &gt;= m*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18972>\n\n--- Comment #9 from Suharto Anggono (<mailto:suharto_anggono@yahoo.com|suharto_anggono@yahoo.com>) ---\n(In reply to Suharto Anggono from comment #5)\nunits(diff(.leap.seconds[1], units = \"weeks\"))\nOriginal: \"secs\"\nChanged: \"weeks\"\n\nunits(diff(as.Date(.leap.seconds[1]), units = \"weeks\"))\nOriginal: \"days\"\nChanged: \"weeks\"\n\n\nUsing an example from\n<https:\/\/stat.ethz.ch\/pipermail\/r-devel\/2013-February\/065738.html> , by the\nchange to \"POSIXt\" method,\ndiff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"), d=2)\nand\ndiff(diff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"))\nbecome the same.\n\nunits(diff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"), d=2))\nOriginal: \"secs\"\nChanged: \"days\"\n\n\nBy the change to the default method,\ndiff(logical(1))\nbecomes the same as\nlogical(0) - logical(0)\n\nstorage.mode(diff(logical(1)))\nOriginal: \"logical\"\nChanged: \"integer\"",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764946714.735499",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "i1I",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "*[Bug 18972] diff(x=<m-by-n>, l, d) drops dimensions when l*d >= m*\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18972"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #9 from Suharto Anggono ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:suharto_anggono@yahoo.com",
                                "text": "suharto_anggono@yahoo.com"
                            },
                            {
                                "type": "text",
                                "text": ") ---\n(In reply to Suharto Anggono from comment #5)\nunits(diff(.leap.seconds[1], units = \"weeks\"))\nOriginal: \"secs\"\nChanged: \"weeks\"\n\nunits(diff(as.Date(.leap.seconds[1]), units = \"weeks\"))\nOriginal: \"days\"\nChanged: \"weeks\"\n\n\n\nUsing an example from\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/stat.ethz.ch\/pipermail\/r-devel\/2013-February\/065738.html"
                            },
                            {
                                "type": "text",
                                "text": " , by the\nchange to \"POSIXt\" method,\ndiff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"), d=2)\nand\ndiff(diff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"))\nbecome the same.\n\nunits(diff(as.POSIXct(c(\"2012-01-01\", \"2012-02-01\"), tz=\"UTC\"), d=2))\nOriginal: \"secs\"\nChanged: \"days\"\n\n\n\nBy the change to the default method,\ndiff(logical(1))\nbecomes the same as\nlogical(0) - logical(0)\n\nstorage.mode(diff(logical(1)))\nOriginal: \"logical\"\nChanged: \"integer\""
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18977] model.frame(~1, list()) constructs an invalid data frame*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977>\n\nMartin Maechler (<mailto:maechler@stat.math.ethz.ch|maechler@stat.math.ethz.ch>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|UNCONFIRMED                 |CONFIRMED\n     Ever confirmed|0                           |1\n                 CC|                            |maechler@stat.math.ethz.ch\n\n--- Comment #1 from Martin Maechler (<mailto:maechler@stat.math.ethz.ch|maechler@stat.math.ethz.ch>) ---\nThank you, Mikael.  I'd agree that this is a bug, and also your patch makes\nsense.  I've applied it in my checkout of R-devel; then found that your checks\nworked with one exception:\n\nWhere in R 4.5.2 patched,\n\n```\nchk(mfc &lt;- model.frame(~1, dc), c0)\n```\nworked fine,\nafter your patch, the `row.names` are now `integer(0)` instead of\n`character(0)`  and hence, I had to use\n\n```\nchk(mfc &lt;- model.frame(~1, dc), i0) # i0 newly, was c0 !!\n```\n\nwhich did surprise me slightly, well, notably as you did see?\/expect the old\none to continue working.\nComments?",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764974984.024589",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "f+w",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18977] model.frame(~1, list()) constructs an invalid data frame",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977"
                            },
                            {
                                "type": "text",
                                "text": "\n\nMartin Maechler ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:maechler@stat.math.ethz.ch",
                                "text": "maechler@stat.math.ethz.ch",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n             Status|UNCONFIRMED                 |CONFIRMED\n     Ever confirmed|0                           |1\n                 CC|                            |maechler@stat.math.ethz.ch\n\n--- Comment #1 from Martin Maechler ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:maechler@stat.math.ethz.ch",
                                "text": "maechler@stat.math.ethz.ch",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": ") ---\nThank you, Mikael.  I'd agree that this is a bug, and also your patch makes\nsense.  I've applied it in my checkout of R-devel; then found that your checks\nworked with one exception:\n\nWhere in R 4.5.2 patched,\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "chk(mfc <- model.frame(~1, dc), c0)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "worked fine,\nafter your patch, the "
                            },
                            {
                                "type": "text",
                                "text": "row.names",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " are now "
                            },
                            {
                                "type": "text",
                                "text": "integer(0)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " instead of\n"
                            },
                            {
                                "type": "text",
                                "text": "character(0)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "  and hence, I had to use\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "chk(mfc <- model.frame(~1, dc), i0) # i0 newly, was c0 !!\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nwhich did surprise me slightly, well, notably as you did see?\/expect the old\none to continue working.\nComments?"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18977] model.frame(~1, list()) constructs an invalid data frame*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977>\n\n--- Comment #2 from Mikael Jagan (<mailto:jaganmn@mcmaster.ca|jaganmn@mcmaster.ca>) ---\nSorry, Martin - I simply copied the wrong diff into Bugzilla.  What I shared in\ncomment 0 is my first patch attempt, failing one test as you noticed.  What I\nintended to share was the diff below, differing from the original one only in\nthe replacement of `nr &gt; 0` with `row_names ! R_NilValue` in the first modified\nline.\n\n```\nIndex: src\/library\/stats\/src\/model.c\n===================================================================\n--- src\/library\/stats\/src\/model.c       (revision 89085)\n+++ src\/library\/stats\/src\/model.c       (working copy)\n@@ -169,15 +169,17 @@\n     PROTECT(tmp = mkString(\"data.frame\"));\n     setAttrib(data, R_ClassSymbol, tmp);\n     UNPROTECT(1);\n-    if (length(row_names) == nr) {\n+    if (length(row_names) == nr &amp;&amp; row_names != R_NilValue) {\n        setAttrib(data, R_RowNamesSymbol, row_names);\n     } else {\n        \/*\n        PROTECT(row_names = allocVector(INTSXP, nr));\n        for (i = 0; i &lt; nr; i++) INTEGER(row_names)[i] = i+1; *\/\n-       PROTECT(row_names = allocVector(INTSXP, 2));\n+       PROTECT(row_names = allocVector(INTSXP, (nr &gt; 0) ? 2 : 0));\n+       if (nr &gt; 0) {\n        INTEGER(row_names)[0] = NA_INTEGER;\n        INTEGER(row_names)[1] = nr;\n+       }\n        setAttrib(data, R_RowNamesSymbol, row_names);\n        UNPROTECT(1);\n     }\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1764989730.505439",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "vwo5",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18977] model.frame(~1, list()) constructs an invalid data frame",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18977"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #2 from Mikael Jagan ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:jaganmn@mcmaster.ca",
                                "text": "jaganmn@mcmaster.ca"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nSorry, Martin - I simply copied the wrong diff into Bugzilla.  What I shared in\ncomment 0 is my first patch attempt, failing one test as you noticed.  What I\nintended to share was the diff below, differing from the original one only in\nthe replacement of "
                            },
                            {
                                "type": "text",
                                "text": "nr > 0",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " with "
                            },
                            {
                                "type": "text",
                                "text": "row_names ! R_NilValue",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " in the first modified\nline.\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Index: src\/library\/stats\/src\/model.c\n===================================================================\n--- src\/library\/stats\/src\/model.c       (revision 89085)\n+++ src\/library\/stats\/src\/model.c       (working copy)\n@@ -169,15 +169,17 @@\n     PROTECT(tmp = mkString(\"data.frame\"));\n     setAttrib(data, R_ClassSymbol, tmp);\n     UNPROTECT(1);\n-    if (length(row_names) == nr) {\n+    if (length(row_names) == nr && row_names != R_NilValue) {\n        setAttrib(data, R_RowNamesSymbol, row_names);\n     } else {\n        \/*\n        PROTECT(row_names = allocVector(INTSXP, nr));\n        for (i = 0; i < nr; i++) INTEGER(row_names)[i] = i+1; *\/\n-       PROTECT(row_names = allocVector(INTSXP, 2));\n+       PROTECT(row_names = allocVector(INTSXP, (nr > 0) ? 2 : 0));\n+       if (nr > 0) {\n        INTEGER(row_names)[0] = NA_INTEGER;\n        INTEGER(row_names)[1] = nr;\n+       }\n        setAttrib(data, R_RowNamesSymbol, row_names);\n        UNPROTECT(1);\n     }\n"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]