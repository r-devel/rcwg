[
    {
        "subtype": "bot_message",
        "text": "*[Bug 18970] wrapper around `proportions()` to ease publication-like table preparation [with patch]*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18970>\n\nElin Waring (<mailto:elin.waring@gmail.com|elin.waring@gmail.com>) changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n                 CC|                            |elin.waring@gmail.com\n\n--- Comment #3 from Elin Waring (<mailto:elin.waring@gmail.com|elin.waring@gmail.com>) ---\nThe issue of how to handle the \"valid percent\" issue is with the `useNA`\nargument in `table()`.   The structure is a little different than with other\nfunctions (which generally use `na.rm` and `na.omit` in various combinations.\n`xtabs()` has `na.action`, `na.remove`, addNA and na.print to handle the\ncomplexity of ways that it is possible to incorporate\/exclude NAs both in the\nobject and in the printing of the object.\n\nIt's basically true that it is very challenging to get \"nice\" crosstabs,\nsimilar to what you get in the commercial software, in base R. The use of magic\nnumbers for controlling the calculation of proportions is confusing and\ninconsistent. But it has been that way forever and I'd suspect that a\nrethinking would be very disruptive.\n\nUsing the `tbl` from your report\n\n```\ntbl |&gt; prop.table(2) |&gt; addmargins()\ntbl |&gt; addmargins() |&gt; prop.table(2)\n```\nGive different proportions.  I'm pretty sure that is because the table with the \nmargin does not take into account the added \"Sum\" rows in doing the\ncalculation. \nAlso you can't get both the proportion and the number because calculating the\nproportion replaces the `Freq` column in the table object. (Things would have\nbeen different if the proportions were appended rather than replacing.)\n\n\n As someone who teaches in a field which uses crosstabs _a lot_, it's\nfrustrating. But there are many packages that give you options for such\nflexibility to get the output that you want and will also output them nicely to\nLaTex.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1765666598.529599",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "BU7i",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18970] wrapper around ",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "proportions()",
                                "style": {
                                    "bold": true,
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " to ease publication-like table preparation [with patch]",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18970"
                            },
                            {
                                "type": "text",
                                "text": "\n\nElin Waring ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:elin.waring@gmail.com",
                                "text": "elin.waring@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": ") changed:\n\n           What    |Removed                     |Added\n----------------------------------------------------------------------------\n                 CC|                            |elin.waring@gmail.com\n\n--- Comment #3 from Elin Waring ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:elin.waring@gmail.com",
                                "text": "elin.waring@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nThe issue of how to handle the \"valid percent\" issue is with the "
                            },
                            {
                                "type": "text",
                                "text": "useNA",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\nargument in "
                            },
                            {
                                "type": "text",
                                "text": "table()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ".   The structure is a little different than with other\nfunctions (which generally use "
                            },
                            {
                                "type": "text",
                                "text": "na.rm",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " and "
                            },
                            {
                                "type": "text",
                                "text": "na.omit",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " in various combinations.\n"
                            },
                            {
                                "type": "text",
                                "text": "xtabs()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " has "
                            },
                            {
                                "type": "text",
                                "text": "na.action",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", "
                            },
                            {
                                "type": "text",
                                "text": "na.remove",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", addNA and na.print to handle the\ncomplexity of ways that it is possible to incorporate\/exclude NAs both in the\nobject and in the printing of the object.\n\nIt's basically true that it is very challenging to get \"nice\" crosstabs,\nsimilar to what you get in the commercial software, in base R. The use of magic\nnumbers for controlling the calculation of proportions is confusing and\ninconsistent. But it has been that way forever and I'd suspect that a\nrethinking would be very disruptive.\n\nUsing the "
                            },
                            {
                                "type": "text",
                                "text": "tbl",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " from your report\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "tbl |> prop.table(2) |> addmargins()\ntbl |> addmargins() |> prop.table(2)\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Give different proportions.  I'm pretty sure that is because the table with the \nmargin does not take into account the added \"Sum\" rows in doing the\ncalculation. \nAlso you can't get both the proportion and the number because calculating the\nproportion replaces the "
                            },
                            {
                                "type": "text",
                                "text": "Freq",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " column in the table object. (Things would have\nbeen different if the proportions were appended rather than replacing.)\n\n\n\n As someone who teaches in a field which uses crosstabs "
                            },
                            {
                                "type": "text",
                                "text": "a lot",
                                "style": {
                                    "italic": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", it's\nfrustrating. But there are many packages that give you options for such\nflexibility to get the output that you want and will also output them nicely to\nLaTex."
                            }
                        ]
                    }
                ]
            }
        ]
    }
]