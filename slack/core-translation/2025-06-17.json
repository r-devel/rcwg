[
    {
        "user": "U04JHNDSEKX",
        "type": "message",
        "ts": "1750157923.834289",
        "client_msg_id": "60f84fa8-f822-459c-a12e-38572f77454a",
        "text": "On it, there is an issue I am facing in generating the diff which is causing the translation files without any translations to be added in the diff as well which in turn is making the diff size very large\ncurrently fixing that\nwill be done soon!",
        "team": "T01DW9DLB2A",
        "user_team": "T01DW9DLB2A",
        "source_team": "T01DW9DLB2A",
        "user_profile": {
            "avatar_hash": "562f67cbff30",
            "image_72": "https:\/\/avatars.slack-edge.com\/2025-02-22\/8494625043139_562f67cbff30345f6ac4_72.jpg",
            "first_name": "Avinab",
            "real_name": "Avinab Neogy",
            "display_name": "Avinab",
            "team": "T01DW9DLB2A",
            "name": "f20201625",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1750070821.690539",
        "parent_user_id": "U0524MK6H3K",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "0\/JkJ",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "On it, there is an issue I am facing in generating the diff which is causing the translation files without any translations to be added in the diff as well which in turn is making the diff size very large\ncurrently fixing that\nwill be done soon!"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "clapping",
                "users": [
                    "U027JEHGZRA"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U0524MK6H3K",
        "type": "message",
        "ts": "1750164228.957279",
        "edited": {
            "user": "U0524MK6H3K",
            "ts": "1750164300.000000"
        },
        "client_msg_id": "79d2b37f-95bd-4a12-b0bd-2f7ff282ce3c",
        "text": "The question is more about the process of the actual merge. Where do the \"string updated in the repository\" events come from? I think there is a script somewhere that helps resolve the conflicts? The more recent good translations are thrown away and replaced with the older, wrong versions of the translations. I'd like to help debug that, but I don't know where to start.",
        "team": "T01DW9DLB2A",
        "user_team": "T01DW9DLB2A",
        "source_team": "T01DW9DLB2A",
        "user_profile": {
            "avatar_hash": "gc7f0c5d391a",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/c7f0c5d391a6f869c9310694b55fa506.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0018-72.png",
            "first_name": "Ivan",
            "real_name": "Ivan Krylov",
            "display_name": "Ivan Krylov",
            "team": "T01DW9DLB2A",
            "name": "ikrylov",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1750070821.690539",
        "parent_user_id": "U0524MK6H3K",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "kwU+t",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "The question is more about the process of the actual merge. Where do the \"string updated in the repository\" events come from? I think there is a script somewhere that helps resolve the conflicts? The more recent good translations are thrown away and replaced with the older, wrong versions of the translations. I'd like to help debug that, but I don't know where to start."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U027JEHGZRA",
        "type": "message",
        "ts": "1750170346.782809",
        "client_msg_id": "0dbe52b0-2527-4896-ac28-4f75202403a9",
        "text": "ah, sorry, I misunderstood the issue. then I'm looking into this.",
        "team": "T01DW9DLB2A",
        "user_team": "T01DW9DLB2A",
        "source_team": "T01DW9DLB2A",
        "user_profile": {
            "avatar_hash": "67eb97d51d7a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-07-07\/2251315439203_67eb97d51d7a584014d2_72.jpg",
            "first_name": "Gergely",
            "real_name": "Gergely Dar贸czi",
            "display_name": "Gergely Dar贸czi",
            "team": "T01DW9DLB2A",
            "name": "daroczig",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1750070821.690539",
        "parent_user_id": "U0524MK6H3K",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ye1YF",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "ah, sorry, I misunderstood the issue. then I'm looking into this."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "user": "U027JEHGZRA",
        "type": "message",
        "ts": "1750170376.575289",
        "client_msg_id": "61982b97-a283-4f2d-9eba-a991497e8fc9",
        "text": "<@U0524MK6H3K> the git conflict resolution process is documented at <https:\/\/contributor.r-project.org\/translations\/Weblate-server.html#maintenance>, and the helper script can be found at <https:\/\/github.com\/daroczig\/R-weblate-fork\/blob\/main\/deconflict_add_continue.py>",
        "team": "T01DW9DLB2A",
        "user_team": "T01DW9DLB2A",
        "source_team": "T01DW9DLB2A",
        "user_profile": {
            "avatar_hash": "67eb97d51d7a",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-07-07\/2251315439203_67eb97d51d7a584014d2_72.jpg",
            "first_name": "Gergely",
            "real_name": "Gergely Dar贸czi",
            "display_name": "Gergely Dar贸czi",
            "team": "T01DW9DLB2A",
            "name": "daroczig",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1750070821.690539",
        "parent_user_id": "U0524MK6H3K",
        "attachments": [
            {
                "id": 1,
                "footer_icon": "https:\/\/slack.github.com\/static\/img\/favicon-neutral.png",
                "color": "24292f",
                "bot_id": "B01V53YD4FJ",
                "bot_team_id": "T01DW9DLB2A",
                "app_unfurl_url": "https:\/\/github.com\/daroczig\/R-weblate-fork\/blob\/main\/deconflict_add_continue.py",
                "is_app_unfurl": true,
                "app_id": "A01BP7R4KNY",
                "fallback": "<https:\/\/github.com\/daroczig\/R-weblate-fork\/blob\/main\/deconflict_add_continue.py|deconflict_add_continue.py>",
                "text": "```\n#!\/usr\/local\/bin\/python\n\nimport re\nimport subprocess\nimport sys\n\n\ndef get_git_status_output():\n    result = subprocess.run([\"git\", \"status\"], capture_output=True, check=True)\n    return result.stdout.decode(\"utf-8\").split(\"\\n\")\n\n\ndef find_both_added_file(status_lines):\n    ii = 0\n\n    while not status_lines[ii].startswith(\"Unmerged paths:\"):\n        ii += 1\n        if ii == len(status_lines):\n            return None\n\n    while True:\n        match = re.search(\"both (?:added|modified): *([^ ]+)$\", status_lines[ii])\n        if match is None:\n            ii += 1\n        else:\n            break\n\n    return match.group(1)\n\n\ndef deconflict(file, which):\n    # search for conflict markers without reading it directly (might fail with character encoding issues)\n    grep_result = subprocess.run(\n        [\"grep\", \"-E\", \"(<<<<|====|>>>>)\", file], capture_output=True\n    )\n    if grep_result.returncode == 1:\n        print(f\"No conflict markers found in {file}\")\n        return\n\n    with open(file) as f:\n        contents = f.read()\n\n    lines = contents.split(\"\\n\")\n\n    n_conflicts = sum([l.startswith(\"<<<<\") for l in lines])\n\n    keep = True\n    outfile = []\n\n    if which == \"left\" or which == \"svn\":\n        start_drop = \"====\"\n        start_keep = \">>>>\"\n        keep_skip = \"<<<<\"\n    elif which == \"right\" or which == \"weblate\":\n        start_drop = \"<<<<\"\n        start_keep = \"====\"\n        keep_skip = \">>>>\"\n    else:\n        raise ValueError('Unrecognized value of which \"{}\"'.format(which))\n\n    for line in lines:\n        if line.startswith(start_drop):\n            keep = False\n        elif line.startswith(start_keep):\n            keep = True\n        elif keep and not line.startswith(keep_skip):\n            outfile.append(line)\n\n    conflicts_markers_remaining = sum(\n        [\n            l.startswith(\"<<<<\") or l.startswith(\"====\") or l.startswith(\">>>>\")\n            for l in outfile\n        ]\n    )\n    if conflicts_markers_remaining:\n        raise ValueError(\n            \"Still {} conflict markers remaining!\".format(conflict_markers_remaining)\n        )\n\n    print(\n        \"Removed {} lines and {} conflicts\".format(\n            (len(lines) - len(outfile)), n_conflicts\n        )\n    )\n\n    with open(file, \"w\") as f:\n        for line in outfile:\n            _ = f.write(line + \"\\n\")\n\n\nwhich = sys.argv[1]\n\nwhile (file := find_both_added_file(get_git_status_output())) is not None:\n    print(f\"De-conflicting {file} by using the edits from {which}\")\n    deconflict(file, which)\n    subprocess.call([\"git\", \"add\", file])\n\nsubprocess.call([\"git\", \"rebase\", \"--continue\"])\nprint(\"Step complete!\\n\\nNew status:\")\nsubprocess.call([\"git\", \"status\"])\n\n```",
                "title": "<https:\/\/github.com\/daroczig\/R-weblate-fork\/blob\/main\/deconflict_add_continue.py|deconflict_add_continue.py>",
                "footer": "<https:\/\/github.com\/daroczig\/R-weblate-fork|daroczig\/R-weblate-fork>",
                "mrkdwn_in": [
                    "text"
                ]
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "A98qU",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "U0524MK6H3K"
                            },
                            {
                                "type": "text",
                                "text": " the git conflict resolution process is documented at "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/contributor.r-project.org\/translations\/Weblate-server.html#maintenance"
                            },
                            {
                                "type": "text",
                                "text": ", and the helper script can be found at "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/daroczig\/R-weblate-fork\/blob\/main\/deconflict_add_continue.py"
                            }
                        ]
                    }
                ]
            }
        ],
        "reactions": [
            {
                "name": "+1",
                "users": [
                    "U0524MK6H3K"
                ],
                "count": 1
            },
            {
                "name": "raised_hands",
                "users": [
                    "U04JHNDSEKX"
                ],
                "count": 1
            }
        ]
    },
    {
        "user": "U0524MK6H3K",
        "type": "message",
        "ts": "1750174262.131659",
        "edited": {
            "user": "U0524MK6H3K",
            "ts": "1750174503.000000"
        },
        "client_msg_id": "2bb9334a-345a-4ed5-83cf-c94633686ee8",
        "text": "Thank you very much for the links!\n\nI may have brought this on myself. Looking at <https:\/\/translate.rx.studio\/translate\/r-project\/stats-r\/ru\/?checksum=97a5bf37f205d2e1#history|this string> in particular, I see it's missing from the Weblate repository at `<https:\/\/translate.rx.studio\/git\/r-project\/base-r-gui\/>`, with `git blame` saying it had been introduced as empty in the 2024-04-01 commit by Michael Lawerence, after I manually `msgmerge`d and submitted the `*.po` files one last time. A later Weblate edit on 2024-04-23 must have been overwritten by an even later rebase (2024-11-08). But why does it keep getting overwritten (2025-03-02 edit vs 2025-04-17 rebase) during subsequent merges?",
        "team": "T01DW9DLB2A",
        "user_team": "T01DW9DLB2A",
        "source_team": "T01DW9DLB2A",
        "user_profile": {
            "avatar_hash": "gc7f0c5d391a",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/c7f0c5d391a6f869c9310694b55fa506.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0018-72.png",
            "first_name": "Ivan",
            "real_name": "Ivan Krylov",
            "display_name": "Ivan Krylov",
            "team": "T01DW9DLB2A",
            "name": "ikrylov",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "thread_ts": "1750070821.690539",
        "parent_user_id": "U0524MK6H3K",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "TLLek",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "Thank you very much for the links!\n\nI may have brought this on myself. Looking at "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/translate.rx.studio\/translate\/r-project\/stats-r\/ru\/?checksum=97a5bf37f205d2e1#history",
                                "text": "this string"
                            },
                            {
                                "type": "text",
                                "text": " in particular, I see it's missing from the Weblate repository at "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/translate.rx.studio\/git\/r-project\/base-r-gui\/",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ", with "
                            },
                            {
                                "type": "text",
                                "text": "git blame",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " saying it had been introduced as empty in the 2024-04-01 commit by Michael Lawerence, after I manually "
                            },
                            {
                                "type": "text",
                                "text": "msgmerge",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "d and submitted the "
                            },
                            {
                                "type": "text",
                                "text": "*.po",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " files one last time. A later Weblate edit on 2024-04-23 must have been overwritten by an even later rebase (2024-11-08). But why does it keep getting overwritten (2025-03-02 edit vs 2025-04-17 rebase) during subsequent merges?"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]